@model WebDAL.DataModels.Items
@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_LayoutClient.cshtml";
}
<section class="comonSection noPaddingBottom" onload="f2()">
    <div class="container">
        <div class="hidden"><input type="text" id="itemid" name="itemid" value="@Model.ItemId" /></div>
        <div class="row">
            <div class="col-lg-6">
                <div class="item shopBimg active">
                    <img src="@Url.Content(Model.ItemImage)" alt="" width="500" height="500">
                </div>
            </div>
            <div class="col-lg-6 noPaddingLeft">
                <div class="singleProInfo">
                    <div class="productinfoTop">
                        <h2 class="productSiTitle">@Model.ItemTitle</h2>
                        <div class="timebid">
                            <p>End Auction : </p>
                            <div id="showtime"></div>
                            @if (Model.BidEndDate < DateTime.Now)
                            {
                                <p>Aution was ended!!!</p>
                            }
                            else
                            {
                                TimeSpan timeRemaining = Model.BidEndDate.Subtract(DateTime.Now);
                                string x = string.Format("{0} Days, {1} Hour(s), {2} Minute(s), {3} Second(s)", timeRemaining.Days, timeRemaining.Hours, timeRemaining.Minutes, timeRemaining.Seconds);
                                <p>@x</p>
                            }
                        </div>
                        <p>Current price: </p>
                        <p class="prices2">&nbsp;$@Model.BidIncrement</p>
                    </div>
                </div>
                <div class="sinShopCont">
                    <p>
                     @Html.Raw( @Model.ItemDescription)
                    </p>
                </div>
                <p>Seller : <a href="@Url.Action("Details","Home",new { id = Model.UserId},null)">@Model.Users.FirstName @Model.Users.LastName</a></p>
                <br />
                @if (Model.BidEndDate > DateTime.Now)
                {
                    <div class="ctyandColor">
                        <div class="product-price form-group">
                            <h4>Bid minimum:</h4>
                            <div  class="form-group">
                                <input type="text" id="minbid" name="minbid" value="@Model.MinimumBid" class="input-text prices text carqty" readonly>
                            </div>
                        </div>
                        <hr />
                        <div class="product-price form-group">
                            <h4>Bid Price:</h4>
                            <div class="form-group">
                                <input type="text" id="price" name="price" value="@Model.BidIncrement" title="price" class="input-text qty text carqty">
                            </div>
                        </div>
                    </div>
                    <div class="product-price">
                        @if (Session["user"] != null)
                        {
                            <button class="btn btn-sm btn-bid vol_btn vol_border"><i class="fa fa-gavel" aria-hidden="true"></i></button>
                        }
                        else
                        {
                            <a href="@Url.Action("Login","Home")">Login to bid</a>
                        }
                    </div>
                }
                else
                {
                    <p>Aution was ended!!!</p>
                }
            </div>
        </div>
        <br />
        <div class="row singprotabW">
            <div class="col-lg-12">
                <div class="text-center">
                    <ul class="singProDectabnav">
                        <li class="active"><a data-toggle="tab" href="#desc">Auction History</a></li>
                    </ul>
                </div>
                <div class="tab-content">
                    <div class="proDectabcon">
                        <div id="order_review" class="woocommerce-checkout-review-order">
                            <div class="orderbg">
                                <table class="shop_table woocommerce-checkout-review-order-table">
                                    <thead>
                                        <tr>
                                            <th class="product-name">Bidder</th>
                                            <th class="product-total">Price</th>
                                            <th class="product-user">Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in ViewBag.history)
                                        {
                                            <tr>
                                                <td>@item.Users.FirstName @item.Users.LastName</td>
                                                <td>@item.BidPrice</td>
                                                <td>@item.BidDate</td>
                                            </tr>
                                        }
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="seperator"></div>
            </div>
        </div>
</section>

@section scripts{
    <script>
        $(function () {
            $(document).on("click", ".btn-bid", function () {
                    $.ajax({
                    type: 'POST',
                    url: '@Url.Action("Bid","Items")',
                    data: {
                        itemid :  $("#itemid").val(),
                        price  :  $("#price").val()
                    },
                    success: function (res) {
                        if (res.status) {
                            alert(res.message);
                            window.location.reload();
                        } else {
                            alert(res.message);
                        }
                    }
                })
            })
        })

    </script>


}